<%- include('../partials/header') %>

<div class="container mt-4">
  <h2>Budgets</h2>

  <a href="/budgets/new" class="btn btn-primary">Add a Budget</a>

  <ul class="list-group mt-3">
    <% let totalAmount = 0 %>
    <% budgets.forEach(function(budget) { %>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <a href="/budgets/<%= budget.id %>" class="text-decoration-none">
          <%= budget.name %>
        </a>
        <div class="text-muted">
          <%= budget.category %>
        </div>
        <div class="text-muted">
          Date: <%= budget.date.toDateString() %>
        </div>
        <% if (budget.notes && budget.notes.length > 0) { %>
        <div>
          Notes:
          <ul>
            <% budget.notes.forEach(function(note) { %>
            <li><%= note %></li>
            <% }); %>
          </ul>
        </div>
        <% } %>
      </div>
      <div class="d-flex">
        <span class="badge bg-secondary">$<%= budget.amount.toFixed(2) %></span>
        <a href="/budgets/<%= budget.id %>/edit" class="btn btn-primary btn-sm ms-2">Edit</a>
        <form action="/budgets/<%= budget.id %>?_method=DELETE" method="POST" class="ms-2">
          <button type="submit" class="btn btn-danger btn-sm">Delete</button>
        </form>
      </div>
    </li>
    <% totalAmount += budget.amount %>
    <% }); %>
  </ul>
  <div class="total-amount text-end mt-3">
    Total amount: $<%= totalAmount.toFixed(2) %>
  </div>
</div>

<%- include('../partials/footer') %>